{% extends "main/base_v2.html" %}

{% block fc_panel %}


<div class="container">
    <div class="top-content d-flex justify-content-between flex-wrap g-5 mb-5">
        <div class="breadcrumbs">
            <a href="{{url_for('admin_control.index')}}">Панель управления </a>
            /
            <span>Контроль финансов</span>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-5">

            <div class="personal_acc_info" id="ServerBalance">Баланс сервиса: <span class="link-warning"><b>{{ balance }} р.</b></span></div>
            <div class="personal_acc_info" >Баланс клиентов сервиса: <span class="link-warning"><b>{{ summ_client }} р.</b></span></div>
            <div class="personal_acc_info">Зарезервировано на пополенние: <span class="link-warning"><b>{{ pending_balance_rf }} р.</b></span></div>
            <div class="personal_acc_info">Баланс агентов тип 1: <span class="link-warning"><b>{{ summ_at1 }} р.</b></span></div>
            <div class="personal_acc_info">Долг агентов тип2: <span class="link-warning"><b>{{ summ_at2 }} р.</b></span></div>
            <div class="d-flex mt-3">
                <div class="me-4">
                    <a href="javascript:perform_wo_transactions(`{{url_for('admin_control.bck_su_bck_wo_transactions')}}`, `{{csrf_token()}}`)"
                       id="wo_transactions_link"
                       class="btn btn-outline-secondary disabled">Провести заказы пользователей</a>
                </div>
                <div >
                    <div class="form-check form-switch">
                        <input type="checkbox" role="switch" id="perform_wo_switchbox"
                               class="form-check-input border border-warning" onchange="toggle_perform_wo()"
                               data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Включатель проведения заказов">
                        <label for="perform_wo_switchbox" class="form-check-label"></label>
                        <script>
                            window.onload = function(){document.getElementById("perform_wo_switchbox").checked = false};
                        </script>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-md-7">
            <h5>Статистика за {{ stat_date.strftime('%d.%m.%Y') }}</h5>
            <div class="row">
              <div class="col">
                <label style="font-size: 28px">Марок</label><br>
                <label class= "text-warning">{{ stat.marks_cnt }}</label>
              </div>
              <div class="col">
                <label style="font-size: 28px">Списано</label><br>
                <label class= "text-warning">{{ stat.amount }} р.</label>
              </div>
              <div class="col">
                <label style="font-size: 28px">Ср/цена</label><br>
                <label class= "text-warning">{{ stat.avg_price }} р.</label>
              </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="btn-md-group mt-2" role="group" aria-label="mainFinBtn">
            <a href='#' onclick="javascript:update_finance_control('service_accounts', this)" class="btn btn-outline-secondary mt-1 active" id="pills-service_accounts"
                data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Настройка банковских счетов. qr коды и реквизиты">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                  <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"/>
                  <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"/>
                  <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"/>
                  <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"/>
                  <path d="M12 9h2V8h-2v1Z"/>
                </svg>
                Счета
            </a>
            <a href='#' onclick="javascript:update_finance_control('promos', this)" class="btn btn-outline-secondary mt-1" id="pills-promos"
               data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Настройка промокодов"
            >
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="currentColor" height="50" width="50" version="1.1" id="Layer_1" viewBox="0 0 511.999 511.999" xml:space="preserve">
                    <g>
                        <g>
                            <g>
                                <path d="M361.079,110.717c3.076-4.802,1.674-11.19-3.128-14.264c-30.42-19.474-65.673-29.769-101.95-29.769     c-104.388,0-189.317,84.927-189.317,189.317s84.928,189.317,189.317,189.317s189.317-84.927,189.315-189.316     c0-42.677-13.861-82.965-40.087-116.509c-3.51-4.491-10-5.286-14.494-1.775c-4.494,3.512-5.288,10.001-1.775,14.495     c23.358,29.876,35.704,65.765,35.704,103.787c0,93.002-75.662,168.664-168.664,168.664S87.337,349.001,87.337,255.999     S162.999,87.336,256.001,87.336c32.323,0,63.725,9.167,90.814,26.51C351.613,116.92,358.003,115.52,361.079,110.717z"/>
                                <path d="M500.389,255.999c0-11.871,2.872-25.02,5.649-37.735c4.878-22.338,9.922-45.437,1.246-66.359     c-9.045-21.812-29.357-34.694-49.002-47.151c-11.117-7.051-21.618-13.709-29.474-21.566     c-7.855-7.856-14.515-18.356-21.564-29.474c-12.458-19.643-25.34-39.956-47.15-49.001c-20.924-8.674-44.021-3.631-66.36,1.247     c-12.715,2.777-25.863,5.648-37.734,5.648c-11.871,0-25.019-2.871-37.734-5.648c-22.337-4.878-45.437-9.922-66.36-1.247     c-21.812,9.044-34.692,29.357-47.15,49.001c-7.049,11.117-13.709,21.618-21.564,29.474c-7.856,7.855-18.358,14.515-29.474,21.564     C34.073,117.21,13.76,130.093,4.715,151.905c-8.675,20.921-3.632,44.019,1.246,66.357c2.777,12.715,5.649,25.864,5.649,37.735     c0,11.871-2.872,25.02-5.649,37.735c-4.878,22.338-9.922,45.437-1.246,66.359c9.046,21.813,29.359,34.695,49.003,47.153     l3.971,2.524c4.808,3.066,11.192,1.656,14.259-3.152c3.069-4.808,1.658-11.192-3.15-14.26l-4.019-2.554     c-17.713-11.232-34.443-21.842-40.987-37.621c-6.192-14.936-2.043-33.931,2.348-54.041c3.01-13.786,6.123-28.042,6.123-42.143     c0-14.1-3.112-28.356-6.123-42.143c-4.391-20.11-8.539-39.105-2.348-54.04c6.544-15.78,23.274-26.39,40.986-37.622     c11.577-7.34,23.545-14.932,33.017-24.402c9.47-9.47,17.062-21.44,24.403-33.017c11.231-17.712,21.841-34.44,37.62-40.983     c14.935-6.194,33.931-2.046,54.043,2.346c13.785,3.01,28.041,6.123,42.14,6.123c14.099,0,28.353-3.112,42.14-6.123     c20.112-4.392,39.109-8.541,54.043-2.346c15.779,6.543,26.387,23.271,37.62,40.983c7.341,11.577,14.933,23.547,24.403,33.017     c9.47,9.47,21.442,17.062,33.017,24.403c17.713,11.232,34.442,21.842,40.986,37.621c6.192,14.936,2.043,33.931-2.347,54.041     c-3.01,13.786-6.123,28.042-6.123,42.143s3.112,28.356,6.123,42.143c4.391,20.11,8.539,39.105,2.347,54.04     c-6.544,15.78-23.274,26.39-40.986,37.622c-11.577,7.34-23.545,14.932-33.017,24.402c-9.47,9.47-17.062,21.44-24.403,33.017     c-11.231,17.712-21.841,34.44-37.62,40.983c-14.935,6.193-33.931,2.046-54.043-2.346c-13.785-3.01-28.041-6.123-42.14-6.123     c-14.099,0-28.353,3.112-42.14,6.123c-20.112,4.392-39.105,8.541-54.043,2.348c-15.779-6.543-26.387-23.273-37.62-40.983     c-2.942-4.639-5.984-9.434-9.124-14.031c-3.219-4.709-9.646-5.916-14.352-2.699c-4.709,3.218-5.918,9.643-2.7,14.352     c2.942,4.304,5.757,8.74,8.735,13.438c12.458,19.643,25.339,39.956,47.15,49.001c8.271,3.428,16.877,4.714,25.645,4.714     c13.416,0,27.206-3.011,40.715-5.963c12.715-2.777,25.863-5.648,37.734-5.648c11.871,0,25.019,2.871,37.734,5.648     c22.338,4.878,45.436,9.922,66.36,1.247c21.812-9.045,34.692-29.357,47.15-49.001c7.049-11.117,13.709-21.618,21.564-29.474     c7.856-7.855,18.357-14.515,29.474-21.564c19.645-12.458,39.957-25.341,49.002-47.153c8.675-20.921,3.632-44.019-1.246-66.357     C503.261,281.019,500.389,267.87,500.389,255.999z"/>
                                <path d="M166.087,345.913c2.017,2.017,4.661,3.025,7.303,3.025c2.642,0,5.286-1.009,7.301-3.025l165.222-165.222     c4.033-4.031,4.033-10.57,0-14.603s-10.57-4.033-14.604,0L166.087,331.31C162.055,335.341,162.055,341.88,166.087,345.913z"/>
                                <path d="M200.927,238.79c20.877,0,37.863-16.985,37.863-37.863c0-20.878-16.986-37.863-37.863-37.863     s-37.863,16.985-37.863,37.863C163.064,221.805,180.05,238.79,200.927,238.79z M200.927,183.716     c9.489,0,17.211,7.72,17.211,17.211c0,9.491-7.72,17.211-17.211,17.211c-9.491,0-17.211-7.72-17.211-17.211     C183.717,191.436,191.437,183.716,200.927,183.716z"/>
                                <path d="M311.075,348.938c20.877,0,37.863-16.985,37.863-37.863c0-20.879-16.986-37.863-37.863-37.863     s-37.863,16.985-37.863,37.863C273.212,331.953,290.198,348.938,311.075,348.938z M311.075,293.864     c9.489,0,17.211,7.72,17.211,17.211c0,9.491-7.72,17.211-17.211,17.211c-9.491,0-17.211-7.72-17.211-17.211     C293.864,301.584,301.584,293.864,311.075,293.864z"/>
                            </g>
                        </g>
                    </g>
                </svg>
                Промо
            </a>
            <a href='#' onclick="javascript:update_finance_control('bonuses', this)" class="btn btn-outline-secondary mt-1" id="pills-bonuses"
               data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Настройка бонуcкодов"
            >
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="currentColor" height="50" width="50" version="1.1" id="Capa_1" viewBox="0 0 352.752 352.752" xml:space="preserve">
                    <g>
                        <g>
                            <path d="M317.778,79.1h-79.137c1.678-1.398,3.309-2.883,4.879-4.453c9.781-9.781,16.399-21.691,18.635-33.539    c2.432-12.889-0.504-24.262-8.266-32.023C247.948,3.141,239.815,0,230.37,0c-14.145,0-29.861,7.272-42.043,19.453    c-4.902,4.904-8.896,10.209-11.982,15.656c-3.125-5.557-7.131-10.865-11.922-15.656C152.241,7.273,136.524,0,122.38,0    c-9.445,0-17.578,3.143-23.521,9.084C83.386,24.56,87.942,53.359,109.229,74.646c1.572,1.572,3.209,3.053,4.889,4.453H34.974    c-17.149,0-31.1,13.951-31.1,31.1v8.1c0,17.148,13.951,31.1,31.1,31.1h4.574v172.254c0,17.148,13.951,31.1,31.1,31.1h211.453    c17.15,0,31.102-13.951,31.102-31.1V149.398h4.576c17.148,0,31.1-13.951,31.1-31.1v-8.1C348.878,93.051,334.927,79.1,317.778,79.1    z M198.935,30.06c9.43-9.43,21.182-15.06,31.436-15.06c3.752,0,9.037,0.814,12.914,4.691c4.148,4.148,5.615,10.766,4.131,18.635    c-1.682,8.912-6.832,18.043-14.502,25.713c-9.428,9.43-21.178,15.061-31.432,15.061c-3.754,0-9.039-0.814-12.916-4.691    C179.356,65.201,184.104,44.891,198.935,30.06z M119.837,64.039c-14.83-14.828-19.578-35.139-10.371-44.348    C113.343,15.814,118.628,15,122.38,15c10.254,0,22.006,5.631,31.437,15.06c7.668,7.668,12.818,16.799,14.5,25.713    c1.484,7.869,0.018,14.486-4.133,18.637c-3.875,3.875-9.162,4.689-12.914,4.689C141.017,79.1,129.267,73.471,119.837,64.039z     M144.679,337.752H70.647c-8.877,0-16.1-7.223-16.1-16.1V149.398h90.131V337.752z M144.679,134.398H34.974    c-8.877,0-16.1-7.223-16.1-16.1v-8.1c0-8.877,7.223-16.1,16.1-16.1h109.705V134.398z M193.073,337.752h-33.395V94.1h33.395    V337.752z M298.202,321.652c0,8.877-7.223,16.1-16.102,16.1h-74.027V149.398h90.129V321.652z M333.878,118.299    c0,8.877-7.223,16.1-16.1,16.1H208.073V94.1h109.705c8.877,0,16.1,7.223,16.1,16.1V118.299z"/>
                        </g>
                    </g>
                </svg>
                Бонус
            </a>
            <a href='#' onclick="javascript:update_finance_control('prices', this)" class="btn btn-outline-secondary mt-1" id="pills-prices" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Настройка ценовых распределений">
                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-cash-coin" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0z"/>
                  <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1h-.003zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195l.054.012z"/>
                  <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083c.058-.344.145-.678.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1H1z"/>
                  <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 5.982 5.982 0 0 1 3.13-1.567z"/>
                </svg>
                <span class="font-8">Цены</span>
            </a>
            <a href="{{ url_for('admin_control.su_control_ut') }}" class="btn btn-outline-secondary mt-1"
               data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Контроль транзакций пользователей">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="50" height="50" viewBox="0 0 1024 1024"><path d="M221.419 490.47c103.339 0 180.565-39.936 180.565-75.605v-58.752c-39.467 29.141-104.235 47.488-180.565 47.488S80.32 385.254 40.854 356.113v58.752c0 35.669 77.227 75.605 180.565 75.605zm0 117.376c106.411 0 180.565-39.851 180.565-75.605v-48.427c-39.467 29.141-104.235 47.531-180.565 47.531S80.32 512.956 40.854 483.814v48.427c0 35.755 74.155 75.605 180.565 75.605zm0 127.019c103.339 0 180.565-39.936 180.565-75.605v-58.069c-39.467 29.141-104.235 47.531-180.565 47.531S80.32 630.333 40.854 601.191v58.069c0 35.669 77.227 75.605 180.565 75.605zm0 128.043c103.339 0 180.565-39.893 180.565-75.605V728.21c-39.467 29.141-104.235 47.531-180.565 47.531S80.32 757.352 40.854 728.21v59.093c0 35.712 77.227 75.605 180.565 75.605zm0-651.392c-106.411 0-180.565 39.851-180.565 75.605 0 35.797 74.155 75.648 180.565 75.648s180.565-39.851 180.565-75.648c0-35.755-74.155-75.605-180.565-75.605zm0-40.875c126.208 0 221.397 50.091 221.397 116.48v510.507c0 4.395-1.408 8.448-3.755 11.819-18.603 55.083-105.899 94.379-217.643 94.379S22.378 864.53 3.775 809.447C1.428 806.076.02 802.023.02 797.628V287.121c0-66.389 95.189-116.48 221.397-116.48zm685.376 288.431c67.797 23.424 113.365 87.381 113.365 159.147 0 92.843-75.52 168.363-168.363 168.363-61.44 0-118.059-33.536-147.669-87.509-5.419-9.856-1.792-22.272 8.107-27.691 9.856-5.461 22.315-1.835 27.733 8.064 22.443 40.875 65.28 66.261 111.829 66.261 70.315 0 127.488-57.216 127.488-127.488 0-54.357-34.475-102.784-85.803-120.533-10.667-3.669-16.341-15.317-12.672-25.984s15.317-16.299 25.984-12.629zm-82.804-2.863c0 92.843-75.52 168.363-168.32 168.363-92.843 0-168.32-75.52-168.32-168.363 0-92.8 75.477-168.32 168.32-168.32 92.8 0 168.32 75.52 168.32 168.32zm-168.32 127.488c70.272 0 127.488-57.173 127.488-127.488 0-70.272-57.216-127.488-127.488-127.488s-127.488 57.216-127.488 127.488c0 70.315 57.216 127.488 127.488 127.488z"/></svg>
                Транзакции
            </a>

    </div>
    <div class="btn-md-group mt-4" role="group" aria-label="secondaryFinBtn">

        <a href="{{ url_for('admin_control.su_fin_order_report') }}" class="btn btn-outline-secondary btn-block"
           data-bs-toggle="tooltip" data-bs-placement="top" title="Отчеты по заказам"
            style="padding: 5px;!important;max-width: 240px; height: 45px">

            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Uploaded to svgrepo.com" width="30" height="30" viewBox="0 0 32 32" xml:space="preserve">
                <style type="text/css">
                    .blueprint_een{fill: #555958;}
                </style>
                <path class="blueprint_een" d="M5,9h18v1H5V9z M5,13h8v9H5V13z M6,21h6v-7H6V21z M16,14h7v-1h-7V14z M16,16h7v-1h-7V16z M16,20h7v-1  h-7V20z M16,18h7v-1h-7V18z M16,22h7v-1h-7V22z M32,7v17c0,2.206-1.794,4-4,4H4c-2.206,0-4-1.794-4-4V5c0-0.552,0.448-1,1-1h26  c0.552,0,1,0.448,1,1v1h3C31.552,6,32,6.448,32,7z M30,8h-3v14h-1V7V6H2v18c0,1.103,0.897,2,2,2h24c1.103,0,2-0.897,2-2V8z"/>
            </svg>
          Заказы
        </a>

        <div onclick="get_marks_count_report(`{{ url_for('admin_control.su_fin_marks_count_report') }}`, '{{ csrf_token() }}', this)"
              class="btn btn-outline-secondary btn-block"
           data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Статистика пользователей по количеству заказанных марок"
           style="padding: 0px; !important; max-width: 240px; font-size: 14px; height: 45px">

            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Uploaded to svgrepo.com" width="22" height="22" viewBox="0 0 32 32" xml:space="preserve">
                <style type="text/css">
                    .blueprint_een { fill: #555958; }
                </style>
                <path class="blueprint_een" d="M5,9h18v1H5V9z M5,13h8v9H5V13z M6,21h6v-7H6V21z M16,14h7v-1h-7V14z M16,16h7v-1h-7V16z M16,20h7v-1  h-7V20z M16,18h7v-1h-7V18z M16,22h7v-1h-7V22z M32,7v17c0,2.206-1.794,4-4,4H4c-2.206,0-4-1.794-4-4V5c0-0.552,0.448-1,1-1h26  c0.552,0,1,0.448,1,1v1h3C31.552,6,32,6.448,32,7z M30,8h-3v14h-1V7V6H2v18c0,1.103,0.897,2,2,2h24c1.103,0,2-0.897,2-2V8z"/>
            </svg>
            Статистика по количеству заказанных марок
        </div>

    </div>
</div>

<div id="finance_control_stages">

    {% include 'admin/finance/sa_accounts.html' %}

    {% include 'admin/finance/promos.html' %}

    {% include 'admin/finance/bonuses.html' %}

    {% include 'admin/finance/prices.html' %}

</div>

<div id="service_prices_modal"></div>

{% include 'helpers/error_modal.html' %}

<script src="{{url_for('static',filename='main_v2/js/admin/admin_uc.js')}}?v=3"></script>
{% endblock %}